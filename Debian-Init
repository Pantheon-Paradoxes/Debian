#!/bin/bash
# Debian Initiation Program

sed -i 's|GRUB_TIMEOUT=5|GRUB_TIMEOUT=1|g' /etc/default/grub
update-grub
sed -i 's#http://deb.debian.org#https://mirrors.huaweicloud.com#g' /etc/apt/sources.list
sed -i 's#http://security.debian.org/debian-security#https://mirrors.huaweicloud.com/debian-security#g' /etc/apt/sources.list
dpkg-reconfigure locales

# firmware-amd-graphics firmware-misc-nonfree firmware-linux-nonfree va-driver-all
apt update
apt upgrade -y
apt install -y bash-completion \
gnome-core gnome-shell desktop-base \
network-manager-gnome gnome-audio gnome-clocks gnome-shell-extension-dashtodock gnome-shell-extension-prefs gnome-keyring gnome-remote-desktop \
policykit-1 policykit-1-gnome power-profiles-daemon fwupd-amd64-signed fwupd \
ssh sudo --no-install-recommends

apt remove -y gnome-contacts
apt autoremove -y
sed -i 'N;$!P;$!D;$d' /etc/network/interfaces

# Debian SSH Root Login and Gnome Automatic Login:
sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/g' /etc/ssh/sshd_config
sed -i 's|#  AutomaticLoginEnable|AutomaticLoginEnable|g' /etc/gdm3/daemon.conf
sed -i '/AutomaticLoginEnable/i\AutomaticLogin=marvin' /etc/gdm3/daemon.conf

# Make sudo Nopassword Setting Avaliable to Non-privilege Users:
Sudo_Line=$(grep "%sudo" /etc/sudoers | tail -1)
echo $Sudo_Line
sed -i "s|$Sudo_Line|%sudo ALL=(ALL:ALL) NOPASSWD:ALL|g" /etc/sudoers
#awk '($1 ~ "%" && !/sudo/) {$2= $2 FS "NOPASSWD:"; print }' /etc/sudoers
sed -i '/privilege specification/a\marvin     ALL=(ALL:ALL) NOPASSWD:ALL' /etc/sudoers

# Vim and Vim.Tiny Configuration Customizing:
cp -f /etc/skel/.bashrc ~/
echo -e '\n' >> ~/.bashrc
echo alias ll="'ls -ahls --color=always'" >> ~/.bashrc
echo alias l="'ls -ahls --color=always'" >> ~/.bashrc

cp -f /etc/skel/.bashrc /home/marvin/
echo -e '\n' >> /home/marvin/.bashrc
echo alias ll="'ls -ahls --color=always'" >> /home/marvin/.bashrc
echo alias l="'ls -ahls --color=always'" >> /home/marvin/.bashrc

echo -e '\n' >> /etc/vim/vimrc.tiny
echo -e '\n' >> /etc/vim/vimrc.tiny
echo set nu >> /etc/vim/vimrc.tiny
echo set ts=4 >> /etc/vim/vimrc.tiny
echo set autoindent >> /etc/vim/vimrc.tiny
echo set hlsearch >> /etc/vim/vimrc.tiny
echo set incsearch >> /etc/vim/vimrc.tiny
echo set showmode >> /etc/vim/vimrc.tiny
echo set showcmd >> /etc/vim/vimrc.tiny
echo set showmatch >> /etc/vim/vimrc.tiny
echo set ignorecase >> /etc/vim/vimrc.tiny
echo set smartcase >> /etc/vim/vimrc.tiny
echo set hidden >> /etc/vim/vimrc.tiny
echo set mouse=a >> /etc/vim/vimrc.tiny
echo set paste >> /etc/vim/vimrc.tiny
echo set nocompatible >> /etc/vim/vimrc.tiny
echo set nobackup >> /etc/vim/vimrc.tiny
echo set noswapfile >> /etc/vim/vimrc.tiny
echo hi cursorLine cterm=bold ctermbg=DarkGray ctermfg=NONE >> /etc/vim/vimrc.tiny
echo set cursorline >> /etc/vim/vimrc.tiny
echo set ruler >> /etc/vim/vimrc.tiny
echo set wrap >> /etc/vim/vimrc.tiny
echo set linebreak >> /etc/vim/vimrc.tiny
echo set laststatus=2 >> /etc/vim/vimrc.tiny

echo -e '\n' >> /etc/vim/vimrc
echo -e '\n' >> /etc/vim/vimrc
echo set nu >> /etc/vim/vimrc
echo set ts=4 >> /etc/vim/vimrc
echo set autoindent >> /etc/vim/vimrc
echo set hlsearch >> /etc/vim/vimrc
echo set incsearch >> /etc/vim/vimrc
echo set showmode >> /etc/vim/vimrc
echo set showcmd >> /etc/vim/vimrc
echo set showmatch >> /etc/vim/vimrc
echo set ignorecase >> /etc/vim/vimrc
echo set smartcase >> /etc/vim/vimrc
echo set hidden >> /etc/vim/vimrc
echo set mouse=a >> /etc/vim/vimrc
echo set paste >> /etc/vim/vimrc
echo set nocompatible >> /etc/vim/vimrc
echo set nobackup >> /etc/vim/vimrc
echo set noswapfile >> /etc/vim/vimrc
echo hi cursorLine cterm=bold ctermbg=DarkGray ctermfg=NONE >> /etc/vim/vimrc
echo set cursorline >> /etc/vim/vimrc
echo set ruler >> /etc/vim/vimrc
echo set wrap >> /etc/vim/vimrc
echo set linebreak >> /etc/vim/vimrc
echo set laststatus=2 >> /etc/vim/vimrc

exit 0
